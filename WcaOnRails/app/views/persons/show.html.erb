<% provide(:title, @person.name) %>

<div class="container">
  <p class="text-center"><%= yield(:title) %></p>
  <% if @person.user.avatar? %>
    <div class="col-sm-6">
      <%= image_tag @person.user.avatar.url, class: "person" %>
    </div>
  <% end %>
  <br />
  <strong>Details</strong>
  <br />
  <table class="table table-condensed table-striped person-results">
    <thead>
      <tr>
        <th>Country</th>
        <th>WCA id</th>
        <th>Gender</th>
        <th>Competitions</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td><%= @person.countryId %></td>
        <td><%= @person.wca_id %></td>
        <td>
          <% if @person.gender == 'm' %>
            Male
          <% elsif @person.gender == 'f' %>
            Female
          <% end %>
        </td>
        <td><%= @person.competitions.count %></td>
      </tr>
    </tbody>
  </table>
  <br />
  <strong>Current personal records</strong>
  <br />
  <table class="table table-condensed table-striped person-results">
    <thead>
      <tr>
        <th>Event</th>
        <th class="text-right">NR</th>
        <th class="text-right">CR</th>
        <th class="text-right">WR</th>
        <th class="text-right">Single</th>
        <th class="text-right">Average</th>
        <th>WR</th>
        <th>CR</th>
        <th>NR</th>
      </tr>
    </thead>
    <tbody>
      <% @events.each do |event| %>
        <% if @person.participated?(event) %>
          <tr>
            <td><%= event.name %></td>
            <td class="text-right"></td>
            <td class="text-right"></td>
            <td class="text-right"><strong><%= @person.world_rank(event, :single) %></strong></td>
            <td class="text-right"><%= @person.best_solve(event, :single).clock_format %></td>
            <td class="text-right"><%=  %></td>
            <td><strong><%= @person.world_rank(event, :average) %></strong></td>
            <td></td>
            <td></td>
          </tr>
        <% end %>
      <% end %>
    </tbody>
  </table>
  <br />
  <strong>History</strong>
  <br />
  <% @events.each do |event| %>
    <% if @person.participated?(event) %>
      <%= event.name %>
      <table class="table table-condensed table-striped person-results">
        <thead>
          <tr>
            <th></th>
            <th>Competition</th>
            <th>Round</th>
            <th>Place</th>
            <th>Result</th>
            <th>details</th>
            <th></th>
            <th></th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @person.results.select { |r| r.eventId == event.id }.each do |result| %>
            <tr>
              <td>
                <%= link_to "/result/#{result.id}" do %>
                  <span class='glyphicon glyphicon-link'></span>
                <% end %>
              </td>
              <td><%= Competition.find(result.competitionId).name %></td>
              <td><%= Round.find(result.roundId).name %></td>
              <td><%= result.pos %></td>
              <td><%= result.value1 %></td>
              <td><%= result.value2 %></td>
              <td><%= result.value3 %></td>
              <td><%= result.value4 %></td>
              <td><%= result.value5 %></td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% end %>
  <% end %>
</div>
